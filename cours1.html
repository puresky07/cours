<html lang="fr">
	<head>
		<title>Première page de cours</title>
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<meta charset="utf-8"/>
	
	</head>
	<body>
	
		<p>Voici un petit paragraphe.</p>
		
		
		<script> // SOURCE : https://www.youtube.com/watch?v=H3WsXg622WA
		
			// modifier objet text
			d3.select("p")
				.text("J'ai remplacé le texte ! Mwahaha.");
			
			// ajouter objet text
			d3.select("p")
				.append("p")
				.text("Je rajoute un titre ici"); // là je vois pas trop la différence
			d3.select("body")
				.append("p")
				.text("Encore un paragraphe");
			
			// Changer le style d'un objet
			d3.select("p")
				.style("color","red");
			
			// console : affichage de l'objet (d3) et toutes les fonctions associées
			console.log(d3);
			
		// PREMIER CONTENEUR SVG
			// il vaut mieux l'assigner à une variable
			var canvas = d3.select("body")
				.append("svg")
				.attr("width",500)
				.attr("height",500)
				
			// Création rectangle background
			var rect = canvas.append("rect")
				.attr("width",500)
				.attr("height",500)
				.attr("fill","#fffccc");
				
			// Création d'un cercle
			var circle = canvas.append("circle")
				.attr("cx",250)
				.attr("cy",250)
				.attr("r",50)
				.attr("fill","red");
			
			// Création d'une ligne
			var line = canvas.append("line")
				.attr("x1",0)
				.attr("y1",0)
				.attr("x2",500)
				.attr("y2",500)
				.attr("stroke","green")
				.attr("stroke-width",5);
				
		// SECOND CONTENEUR SVG
			var w = 500;
			var h = 500;
			
			var dataarea = d3.select("body")
				.append("svg")
				.attr("width",w)
				.attr("height",h)
				.attr("transform", "translate(0,10)");
			
			// Création rectangle background (on l'appelle bg)
			//var bg = dataarea.append("rect")
			//	.attr("width",w)
			//	.attr("height",h)
			//	.attr("fill","#fffccc");
			
			// Work on dataset
			var dataArray = [20,40,50];
			
			// on sélecte ALL les rectangle qui n'existent pas encore !
			var bars = dataarea.selectAll("rect")
				.data(dataArray) //où on récupère les data
				.enter() // place tous les objets qui ne sont pas encore sur la page
					.append("rect")
					.attr("width",function(d) {return d*10;}) // on multiplie par 10 pour voir un peu mieux
					.attr("height",50)
					.attr("fill","blue")
					.attr("y", function(d,i) {return i*100 }); // i = index ; permet qu'il ne s'affichent pas tous l'un sur l'autre. À chaque valeur (i) on décale de i*100px
			
		// COMMENT GÉRER LA TAILLE DES BARS AUTOMATIQUEMENT PAR RAPPORT À LA TAILLE DU SVG ?
		// TROISIÈME CONTENEUR SVG
			var zone = d3.select("body")
				.append("svg")
				.attr("width",w)
				.attr("height",h)
				.attr("transform", "translate(0,10)");
			
			var dataArray2 = [20,40,50,60];
			// on veut récupérer la plus grande valeur
			// donc on crée une var de scale
			var widthScale = d3.scale.linear() // linear est un type de scale qui nous va bien ici
				.domain([0,60]) // min et max de notre dataSet
				.range([0,w]); // min et max souhaités
			
			// pour se marrer on va faire aussi une scale de couleur
			var colorScale = d3.scale.linear()
				.domain([0,60])
				.range(["red","blue"]);
			
			
			var bars = zone.selectAll("rect")
				.data(dataArray2)
				.enter()
					.append("rect")
					.attr("width", function(d) {return widthScale(d);}) 
					.attr("height",50)
					.attr("fill", function(d) {return colorScale(d);})
					.attr("y", function(d,i) {return i*60 });
			
			
			
			
			// COMMENT GROUPER DES SVG
		// QUATRIÈME CONTENEUR
			var w = 1000;
				
			var graph = d3.select("body")
				.append("svg")
				.attr("width",w)
				.attr("height",h)
				.append("g") // on crée un groupe g
				.attr("transform","translate(100,0)");
			
			var dataArray3 = [20,40,50,60];
			var widthScale = d3.scale.linear()
				.domain([0,60])
				.range([0,500]);
			
			var colorScale = d3.scale.linear()
				.domain([0,60])
				.range(["red","blue"]);
			
			var bars = graph.selectAll("rect")
				.data(dataArray3)
				.enter()
					.append("rect")
					.attr("width", function(d) {return widthScale(d);}) 
					.attr("height",50)
					.attr("fill", function(d) {return colorScale(d);})
					.attr("y", function(d,i) {return i*60 });
			
			
			
			// COMMENT AJOUTER UN AXE
			var axis = d3.svg.axis() // CREATE AXIS !
				.ticks(6)
				.scale(widthScale); // define scale
				
			graph.append("g") // Il faut créer un nouveau groupe
				.attr("transform","translate(0,250)") // on décale où on veut
				.call(axis); // on call the axis
		
		// UPDATE DATASET
		// CINQUIÈME CONTENEUR SVG
			var dynam = d3.select("body")
				.append("svg")
				.attr("width",w)
				.attr("height",h);
			
			var data = [10,20,30,40];
			
			// On commence par avoir un cercle déjà existant sur la page
			var circle = dynam.append("circle")
				.attr("cx",50)
				.attr("cy",50)
				.attr("r",30);
			
			var circle2 = dynam.append("circle")
				.attr("cx",150)
				.attr("cy",50)
				.attr("r",30);
			
			var circle = dynam.selectAll("circle") // sélection tous les circles de la page
				.data(data)
				.attr("fill","red") // il met en rouge ceux qui sont déjà existants, pour le nombre de valeurs qu'on a dans data (si y en a plus sur la page ils seront pas colorés)
				.enter()
					.append("circle")
					.attr("cx",50)
					.attr("cy",function(d,i) {return 50+i*70})
					.attr("r",30)
					.attr("fill","green");
			
			// .enter (moins d'éléments déjà existant que de data)
			// .exit (moins de data que d'éléments existants)
			// .update (même nbr d'éléments et de data)
			
		// TRANSITIONS
		// SIXIÈME CONTENEUR SVG
			var move = d3.select("body")
				.append("svg")
				.attr("width",w)
				.attr("height",h);
			
			var circle = move.append("circle")
				.attr("cx",50)
				.attr("cy",50)
				.attr("r",30);
			
			// on veut bouger ce cercle sur la droite + d'autres trucs
			circle.transition()
				.delay(2000)
				.duration(1500)
				.attr("cx",150)
				.attr("cy",150)
				.attr("r",50)
				.attr("fill","brown")
				.transition()
					.delay(8000)
					.duration(4000)
					.attr("fill","green");;
				
			var rect = move.append("rect")
				.attr("x",200)
				.attr("y",50)
				.attr("width",100)
				.attr("height",50);
			
			rect.transition()
				.delay(3000)
				.duration(1500)
				.attr("y",125)
				.transition()
					.duration(1500)
					.attr("fill","green")
					.transition()
						.duration(1500)
						.attr("x",100)
						.each("end",function() {d3.select(this).attr("width",0)}); // each : listener de "end"(of transition), lorsque la transition est terminée, la fonction est exécutée
			
		// IMPORT EXTERNAL DATA
		// SEPTIÈME CONTENEUR SVG
			// files : mydata.csv & mydata.json
			
			// charger les données json
			d3.json("mydata.json", function(k) { // function callback
				var canba = d3.select("body")
					.append("svg")
					.attr("width",500)
					.attr("height",500);
				
				canba.selectAll("rect")
					.data(k)
					.enter()
						.append("rect")
						.attr("width", function(l) {return l.age * 10;}) // on appelle la colonne souhaitée en précisant le nom .age
						.attr("height",50)
						.attr("y", function(l,i) {return i*60;})
						.attr("fill","blue");
				
				canba.selectAll("text")
					.data(k)
					.enter()
						.append("text")
						.attr("fill","white")
						.attr("y", function(l,i) {return i*60+30;})
						.attr("x", 10)
						.text(function(l) {return l.name;});
			
			})
			
			// charger le csv : pareil avec d3.csv() ;)
			
		</script>
	
	
	</body>


</html>
